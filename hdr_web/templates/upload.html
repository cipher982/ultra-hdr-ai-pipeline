{% extends "base.html" %}

{% block content %}
<!-- Page Header -->
<div style="padding: 40px 30px; text-align: center; background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
    <h1 style="color: #333; font-size: 2.2rem; margin-bottom: 15px;">HDR Photo Restorer</h1>
    <p class="subtitle">Restore HDR to photos that lost their dynamic range through AI editing</p>
</div>

<form id="upload-form" method="post" action="/process" enctype="multipart/form-data">
    <!-- Upload Zone -->
    <div class="upload-zone" id="upload-zone">
        <input type="file" id="file-input" name="file" accept="image/*" style="display: none;">
        <div class="upload-content">
            <div class="upload-icon">ðŸ“¸</div>
            <div class="upload-text">
                <h3>Drop your photo here or click to browse</h3>
                <p>Restore HDR to AI-edited photos â€¢ Support for JPEG and PNG â€¢ Max 50MB</p>
            </div>
        </div>
    </div>
    
    <!-- Preview Section (hidden initially) -->
    <div id="preview-section" class="hidden">
        <div class="image-comparison">
            <div class="image-side">
                <h3>Original Image</h3>
                <img id="original-preview" class="image-preview" alt="Original">
                <div style="margin-top: 10px;">
                    <span id="filename"></span>
                </div>
            </div>
            
            <div class="arrow">â†’</div>
            
            <div class="image-side">
                <h3>Ready for HDR Processing</h3>
                <div style="padding: 60px 20px; color: #666; text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">âœ¨</div>
                    <p style="font-size: 1.2rem; margin-bottom: 30px;">AI will restore HDR to your photo</p>
                    <button type="submit" class="btn" id="process-btn">
                        ðŸŽ¨ Create HDR Version
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Processing State (hidden initially) -->
    <div id="processing-section" class="hidden">
        <div class="processing">
            <div class="spinner"></div>
            <h3>Creating HDR Version...</h3>
            <p>This usually takes 2-3 seconds</p>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadZone = document.getElementById('upload-zone');
    const fileInput = document.getElementById('file-input');
    const previewSection = document.getElementById('preview-section');
    const processingSection = document.getElementById('processing-section');
    const originalPreview = document.getElementById('original-preview');
    const filename = document.getElementById('filename');
    const uploadForm = document.getElementById('upload-form');
    
    // File input change handler
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            handleFileUpload(file);
        }
    });
    
    // Drag and drop handlers
    uploadZone.addEventListener('click', () => fileInput.click());
    
    uploadZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });
    
    uploadZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
    });
    
    uploadZone.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileUpload(files[0]);
        }
    });
    
    
    // Form submit handler
    uploadForm.addEventListener('submit', function(e) {
        if (!fileInput.files.length) {
            e.preventDefault();
            alert('Please select a file first');
            return;
        }
        
        // Show processing state
        previewSection.classList.add('hidden');
        processingSection.classList.remove('hidden');
    });
    
    function handleFileUpload(file) {
        // Validate file type
        if (!file.type.startsWith('image/')) {
            alert('Please select an image file');
            return;
        }
        
        // Validate file size (10MB limit)
        if (file.size > 10 * 1024 * 1024) {
            alert('File size must be less than 10MB');
            return;
        }
        
        // Create preview
        const reader = new FileReader();
        reader.onload = function(e) {
            originalPreview.src = e.target.result;
            filename.textContent = file.name;
            
            // Show preview section
            uploadZone.style.display = 'none';
            previewSection.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
    }
    
    // Allow changing file after selection
    originalPreview.addEventListener('click', function() {
        fileInput.click();
    });
});
</script>
{% endblock %}